# 4.6.3.1 前端跨域

## 什么是同源策略？

>同源策略/SOP（Same origin policy）是一种约定，由Netscape公司1995年引入浏览器，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到XSS、CSFR等攻击。

所谓同源是指 **"协议+域名+端口"** 三者相同，即便两个不同的域名指向同一个ip地址，也非同源。

- 同源策略限制以下几种行为：

  - 1.) Cookie、LocalStorage 和 IndexDB 无法读取
  - 2.) DOM 和 Js对象无法获得
  - 3.) AJAX 请求不能发送

- 跨域解决方案
  - 1、 通过jsonp跨域
  - 2、 document.domain + iframe跨域
  - 3、 location.hash + iframe
  - 4、 window.name + iframe跨域
  - 5、 postMessage跨域
  - 6、 跨域资源共享（CORS）
  - 7、 nginx代理跨域
  - 8、 nodejs中间件代理跨域
  - 9、 WebSocket协议跨域


## 1.JSONP
- 原理: 动态创建 script 标签

- 缺点： 只能实现get一种请求

- demo:
```
<script>
    var script = document.createElement('script');
    script.type = 'text/javascript';

    // 传参一个回调函数名给后端，方便后端返回时执行这个在前端定义的回调函数
    script.src = 'http://www.**.com/login?user=admin&callback=handleCallback';
    document.head.appendChild(script);

    // 回调执行函数
    function handleCallback(res) {
        alert(JSON.stringify(res));
    }
 </script>
 
# 服务端返回如下（返回时即执行全局函数）：

handleCallback({"status": true, "user": "admin"})


# 2.）jquery ajax：

$.ajax({
    url: 'http://www.domain2.com:8080/login',
    type: 'get',
    dataType: 'jsonp',  // 请求方式为jsonp
    jsonpCallback: "handleCallback",    // 自定义回调函数名
    data: {}
});


# 3.）vue.js：

this.$http.jsonp('http://www.domain2.com:8080/login', {
    params: {},
    jsonp: 'handleCallback'
}).then((res) => {
    console.log(res); 
})


# 后端node.js代码示例：

var querystring = require('querystring');
var http = require('http');
var server = http.createServer();

server.on('request', function(req, res) {
    var params = qs.parse(req.url.split('?')[1]);
    var fn = params.callback;

    // jsonp返回设置
    res.writeHead(200, { 'Content-Type': 'text/javascript' });
    res.write(fn + '(' + JSON.stringify(params) + ')');

    res.end();
});

server.listen('8080');
console.log('Server is running at port 8080...');
 
```

## 2.CORS


## 3.代理


>Nginx配置



## 参考
- [前端常见跨域解决方案](https://segmentfault.com/a/1190000011145364)

- []()

- []()
